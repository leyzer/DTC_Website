{% extends "layout.html" %}
{% block title %}League{% endblock %}

{% block main %}
<div class="league-container">

    <!-- User Dashboard (if logged in) -->
    {% if user_stats and current_user %}
    <div class="row mb-4">
        <div class="col-12">
            <div class="card bg-light">
                <div class="card-body">
                    <h5 class="card-title mb-3">Welcome, {{ user_stats.full_name }}! üëã</h5>
                    <div class="row text-center">
                        <div class="col-sm-6 col-lg-2 mb-3">
                            <div class="stat-box">
                                <div class="stat-number">{{ user_stats.total_games or 0 }}</div>
                                <div class="stat-label">Games Played</div>
                            </div>
                        </div>
                        <div class="col-sm-6 col-lg-2 mb-3">
                            <div class="stat-box">
                                <div class="stat-number text-success">{{ user_stats.wins or 0 }}</div>
                                <div class="stat-label">Wins</div>
                            </div>
                        </div>
                        <div class="col-sm-6 col-lg-2 mb-3">
                            <div class="stat-box">
                                <div class="stat-number text-danger">{{ user_stats.losses or 0 }}</div>
                                <div class="stat-label">Losses</div>
                            </div>
                        </div>
                        <div class="col-sm-6 col-lg-2 mb-3">
                            <div class="stat-box">
                                <div class="stat-number text-info">{{ user_stats.draws or 0 }}</div>
                                <div class="stat-label">Draws</div>
                            </div>
                        </div>
                        <div class="col-sm-6 col-lg-2 mb-3">
                            <div class="stat-box">
                                <div class="stat-number">{{ (user_stats.avg_rating|round)|int or 400 }}</div>
                                <div class="stat-label">Avg Rating</div>
                            </div>
                        </div>
                        <div class="col-sm-6 col-lg-2 mb-3">
                            <div class="stat-box">
                                <div class="stat-number">{{ user_stats.systems_played or 0 }}</div>
                                <div class="stat-label">Systems</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Year selector -->
    <div class="year-selector">
        <form method="post" class="form-inline">
            <label for="year">Season:</label>
            <select name="year" id="year" onchange="this.form.submit()">
                <option value="" disabled>Select Year</option>
                {% for y in years %}
                    <option value="{{ y.year }}" {% if y.year == selected_year %}selected{% endif %}>
                        {{ y.year }}
                    </option>
                {% endfor %}
            </select>
        </form>
    </div>

    <!-- System ratings in compact cards -->
    <div class="systems-grid">
        {% for sys_code, sys_data in system_tables.items() %}
            <div class="system-card">
                <h3>{{ sys_data.system_name }}</h3>
                <table class="table table-sm table-hover">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Player</th>
                            <th>Rating</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for user in sys_data.users if user.system_member %}
                            <tr>
                                <td>{{ loop.index }}</td>
                                <td>
                                    {{ user.full_name }}
                                    {% if user.club_member %}<span class="star">‚≠ê</span>{% endif %}
                                </td>
                                <td>{{ user.rating }}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% endfor %}
    </div>
</div>

<style>
.stat-box {
    padding: 1rem;
    background: white;
    border-radius: 8px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

.stat-number {
    font-size: 1.75rem;
    font-weight: bold;
    color: #007bff;
}

.stat-label {
    font-size: 0.875rem;
    color: #6c757d;
    margin-top: 0.5rem;
}
</style>
{% endblock %}
