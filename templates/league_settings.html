{% extends "layout.html" %}

{% block title %}League Settings{% endblock %}

{% block main %}
<div class="container mt-4">
    <div class="card">
        <div class="card-header bg-danger text-white">
            <h3 class="mb-0">League Settings</h3>
        </div>
        <div class="card-body">
            <form method="get" action="{{ url_for('admin.league_settings') }}" class="mb-4">
                <label for="yearSelect" class="form-label"><strong>Select Year</strong></label>
                <div class="input-group">
                    <select id="yearSelect" name="year" class="form-select" onchange="window.location.href='{{ url_for('admin.league_settings') }}?year=' + this.value;">
                        {% for s in seasons %}
                            <option value="{{ s.year }}" {% if s.year == selected_year %}selected{% endif %}>{{ s.year }}</option>
                        {% endfor %}
                    </select>
                </div>
            </form>

            <form method="post" action="{{ url_for('admin.league_settings') }}">
                <input type="hidden" name="year" value="{{ selected_year }}">
                
                <div class="mb-4">
                    <h5>Option A Scoring Settings for {{ selected_year }}</h5>
                    <hr>
                    
                    <div class="mb-3">
                        <label for="opponent_limit" class="form-label">Maximum Matches Per Opponent</label>
                        <p class="text-muted small">
                            For Option A (Points-Based) scoring: This setting controls the maximum number of games 
                            against the same opponent that will count towards the league standings for the {{ selected_year }} season.
                        </p>
                        <div class="input-group mb-2">
                            <input 
                                type="number" 
                                class="form-control" 
                                id="opponent_limit" 
                                name="opponent_limit" 
                                value="{{ opponent_limit }}"
                                min="1"
                                max="100"
                                required
                            >
                            <span class="input-group-text">matches</span>
                        </div>
                        <small class="form-text text-muted">
                            Default: 3 matches per opponent
                        </small>
                    </div>

                    <div class="alert alert-info">
                        <strong>Current Setting for {{ selected_year }}:</strong> Maximum of <strong>{{ opponent_limit }}</strong> matches per unique opponent 
                        will count towards Option A league standings.
                    </div>
                </div>

                <button type="submit" class="btn btn-danger">Save Settings for {{ selected_year }}</button>
                <a href="{{ url_for('admin.admin_memberships_dashboard') }}" class="btn btn-secondary">Back to Admin</a>
            </form>
        </div>
    </div>

    <div class="card mt-4">
        <div class="card-header bg-light">
            <h5 class="mb-0">How This Works</h5>
        </div>
        <div class="card-body">
            <p>
                This setting only affects the <strong>Option A (Points-Based) Scoring</strong> system shown on the 
                <a href="{{ url_for('stats.overall') }}">Option A Results page</a>.
            </p>
            <p>
                It <strong>does NOT</strong> affect the current system (Option B: Elo Ratings).
            </p>
            <p>
                When calculating Option A league standings:
            </p>
            <ul>
                <li>Each player can earn points from up to {{ opponent_limit }} games against each unique opponent in {{ selected_year }}</li>
                <li>Any games beyond this limit against the same opponent will not count towards the league</li>
                <li>This encourages players to play against a diverse range of opponents</li>
                <li>Each year can have its own setting</li>
            </ul>

            <div class="alert alert-warning mt-3">
                <strong>Note:</strong> When you view Option A Results for {{ selected_year }}, the limit of <strong>{{ opponent_limit }}</strong> will be applied.
            </div>
        </div>
    </div>
</div>
{% endblock %}

