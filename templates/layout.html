<!DOCTYPE html>

<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="initial-scale=1, width=device-width">

  <!-- Bootstrap -->
  <link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" rel="stylesheet">
  <script crossorigin="anonymous" src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
          integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"></script>

  <!-- Custom CSS -->
  <link href="{{ url_for('static', filename='styles.css') }}" rel="stylesheet">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Corben:bold" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Nobile" rel="stylesheet" type="text/css">

  <!-- Charts -->
  <script src="https://cdn.anychart.com/releases/8.0.1/js/anychart-core.min.js"></script>
  <script src="https://cdn.anychart.com/releases/8.0.1/js/anychart-pie.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  

  <!-- Page Title -->
  <title>League {% block title %}{% endblock %}</title>
</head>


    <body>
        <nav class="navbar navbar-expand-md navbar-dark dtc-navbar">
            <div class="container-fluid">
                <a class="navbar-brand dtc-brand" href="/overall">
                    <img src="{{ url_for('static', filename='dtc_logo.png') }}" alt="DTC Logo" class="dtc-logo">
                    <span class="brand-text">Durban Tabletop Club</span>
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar"
                        aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbar">
                    {% if current_user%}
                        <ul class="navbar-nav ms-auto mt-2">
                            <li class="nav-item dropdown">
                                <a class="nav-link dropdown-toggle" href="#" id="systemDropdown" role="button"
                                data-bs-toggle="dropdown" aria-expanded="false">
                                Games Played ‚Äî {{ system_name }}
                                </a>

                                <ul class="dropdown-menu" aria-labelledby="systemDropdown">
                                    {% for sys in systems %}
                                        <li>
                                            <a class="dropdown-item {% if sys.system_id == selected_system %}active{% endif %}"
                                            href="{{ url_for('leagues.gamesPlayed', system_id=sys.system_id) }}">
                                            {{ sys.system_name }}
                                            </a>
                                        </li>
                                    {% endfor %}
                                </ul>
                            </li>

                            
                            <li class="nav-item dropdown">
                                <a class="nav-link dropdown-toggle" href="#" id="statsDropdown" role="button"
                                data-bs-toggle="dropdown" aria-expanded="false">
                                Stats
                                </a>
                                <ul class="dropdown-menu" aria-labelledby="statsDropdown">
                                    <li><a class="dropdown-item" href="/factionstats">Faction Stats</a></li>
                                    <li><a class="dropdown-item" href="/playerstats">Player Stats</a></li>
                                    <li><a class="dropdown-item" href="/store_reports">Store Reports</a></li>
                                </ul>
                            </li>
                            <li class="nav-item"><a class="nav-link" href="/elo_ratings">Elo Ratings</a></li>
                            <li class="nav-item"><a class="nav-link" href="{{ url_for('main.events') }}">Events</a></li>
                            <li class="nav-item"><a class="nav-link" href="{{ url_for('main.people') }}">People</a></li>
                            <li class="nav-item"><a class="nav-link" href="{{ url_for('main.documents') }}">Documents</a></li>
                            <li class="nav-item"><a class="nav-link" href="{{ url_for('main.league_formats') }}">League Info</a></li>
                            <li class="nav-item"><a class="nav-link" href="/about">About</a></li>
                            <li class="nav-item"><a class="nav-link" href="{{ url_for('main.contact') }}">Contact</a></li>
                            {% if current_user and current_user.is_admin %}
                                <li class="nav-item"><a class="nav-link" href="{{ url_for('leagues.league') }}">Add Results</a></li>
                                <li class="nav-item dropdown">
                                    <a class="nav-link dropdown-toggle" href="#" id="adminDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                        Admin
                                    </a>
                                    <ul class="dropdown-menu" aria-labelledby="adminDropdown">
                                        <li><a class="dropdown-item" href="{{ url_for('admin.manage_users') }}">Manage Users</a></li>
                                        <li><a class="dropdown-item" href="{{ url_for('admin.admin_memberships_dashboard') }}">Manage Memberships</a></li>
                                        <li><hr class="dropdown-divider"></li>
                                        <li><a class="dropdown-item" href="{{ url_for('admin.batch_upload_users') }}">Batch Add Users</a></li>
                                        <li><a class="dropdown-item" href="{{ url_for('admin.batch_upload') }}">Batch Upload Results</a></li>
                                    </ul>
                                </li>
                            {% endif %}
                        </ul>
                        <ul class="navbar-nav ms-auto mt-2">
                            <li class="nav-item">
                                <button class="nav-link btn btn-link dark-mode-toggle" type="button" aria-label="Toggle dark mode" style="border: none; background: none; padding: 0.5rem 0.75rem; color: rgba(255, 255, 255, 0.9);">
                                    <span class="theme-icon">üåô</span>
                                </button>
                            </li>
                            <li class="nav-item dropdown">
                                <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button"
                                data-bs-toggle="dropdown" aria-expanded="false">
                                Welcome, {{ current_user['user_name'] }}
                                </a>
                                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
                                    <li><a class="dropdown-item" href="/profile">My Profile</a></li>
                                    <li><a class="dropdown-item" href="/logout">Log Out</a></li>
                                </ul>
                            </li>
                        </ul>
                    {% else %}
                        <!-- guest nav -->
                         <ul class="navbar-nav me-auto mt-2">
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="guestStatsDropdown" role="button"
                            data-bs-toggle="dropdown" aria-expanded="false">
                            Stats
                            </a>
                            <ul class="dropdown-menu" aria-labelledby="guestStatsDropdown">
                                <li><a class="dropdown-item" href="/factionstats">Faction Stats</a></li>
                                <li><a class="dropdown-item" href="/playerstats">Player Stats</a></li>
                                <li><a class="dropdown-item" href="/store_reports">Store Reports</a></li>
                            </ul>
                        </li>
                        <li class="nav-item"><a class="nav-link" href="/elo_ratings">Elo Ratings</a></li>
                        <li class="nav-item"><a class="nav-link" href="{{ url_for('main.events') }}">Events</a></li>
                        <li class="nav-item"><a class="nav-link" href="{{ url_for('main.people') }}">People</a></li>
                        <li class="nav-item"><a class="nav-link" href="{{ url_for('main.documents') }}">Documents</a></li>
                        <li class="nav-item"><a class="nav-link" href="/league_formats">League Formats</a></li>
                        <li class="nav-item"><a class="nav-link" href="/about">About</a></li>
                        <li class="nav-item"><a class="nav-link" href="{{ url_for('main.contact') }}">Contact</a></li>
                        </ul>
                        <ul class="navbar-nav ms-auto mt-2">
                            <li class="nav-item">
                                <button class="nav-link btn btn-link dark-mode-toggle" type="button" aria-label="Toggle dark mode" style="border: none; background: none; padding: 0.5rem 0.75rem; color: rgba(255, 255, 255, 0.9);">
                                    <span class="theme-icon">üåô</span>
                                </button>
                            </li>
                            <li class="nav-item"><a class="nav-link" href="/register">Register</a></li>
                            <li class="nav-item"><a class="nav-link" href="/login">Log In</a></li>
                        </ul>
                    {% endif %}
                    
                </div>
            </div>
        </nav>


        
        {% if get_flashed_messages() %}
            <header>
                <div class="alert alert-primary mb-0 text-center" role="alert">
                    {{ get_flashed_messages() | join(" ") }}
                </div>
            </header>
        {% endif %}

        <!-- Breadcrumbs Navigation -->
        {% block breadcrumbs %}
        <nav aria-label="breadcrumb" class="bg-light py-2 border-bottom">
            <div class="container-fluid">
                <ol class="breadcrumb mb-0">
                    {% if request.path == '/' or request.path.startswith('/overall') %}
                        <li class="breadcrumb-item active">Overall</li>
                    {% elif request.path.startswith('/factionstats') %}
                        <li class="breadcrumb-item"><a href="/elo_ratings">üìä Elo Ratings</a></li>
                        <li class="breadcrumb-item active">Faction Stats</li>
                    {% elif request.path.startswith('/playerstats') %}
                        <li class="breadcrumb-item"><a href="/elo_ratings">üìä Elo Ratings</a></li>
                        <li class="breadcrumb-item active">Player Stats</li>
                    {% elif request.path.startswith('/store_reports') %}
                        <li class="breadcrumb-item"><a href="/elo_ratings">üìä Elo Ratings</a></li>
                        <li class="breadcrumb-item active">Store Reports</li>
                    {% elif request.path.startswith('/overall') %}
                        <li class="breadcrumb-item active">Overall</li>
                    {% elif request.path.startswith('/events') %}
                        <li class="breadcrumb-item"><a href="/overall">Overall</a></li>
                        <li class="breadcrumb-item active">Events Calendar</li>
                    {% elif request.path.startswith('/people') %}
                        <li class="breadcrumb-item"><a href="/overall">Overall</a></li>
                        <li class="breadcrumb-item active">Club People</li>
                    {% elif request.path.startswith('/documents') %}
                        <li class="breadcrumb-item"><a href="/overall">Overall</a></li>
                        <li class="breadcrumb-item active">Club Documents</li>
                    {% elif request.path.startswith('/league_formats') %}
                        <li class="breadcrumb-item"><a href="/elo_ratings">üìä Elo Ratings</a></li>
                        <li class="breadcrumb-item active">Scoring Formats</li>
                    {% elif request.path.startswith('/admin/league') %}
                        <li class="breadcrumb-item"><a href="{{ url_for('admin.admin_memberships_dashboard') }}">Admin Dashboard</a></li>
                        <li class="breadcrumb-item active">League Settings</li>
                    {% elif request.path.startswith('/profile') %}
                        <li class="breadcrumb-item"><a href="/elo_ratings">üìä Elo Ratings</a></li>
                        <li class="breadcrumb-item active">My Profile</li>
                    {% elif request.path.startswith('/league') %}
                        <li class="breadcrumb-item"><a href="{{ url_for('leagues.league') }}">Add Results</a></li>
                    {% elif request.path.startswith('/admin/memberships') %}
                        <li class="breadcrumb-item"><a href="{{ url_for('admin.admin_memberships_dashboard') }}">Admin Dashboard</a></li>
                        <li class="breadcrumb-item active">Manage Memberships</li>
                    {% elif request.path.startswith('/admin/manage_users') %}
                        <li class="breadcrumb-item"><a href="{{ url_for('admin.admin_memberships_dashboard') }}">Admin Dashboard</a></li>
                        <li class="breadcrumb-item active">Manage Users</li>
                    {% elif request.path.startswith('/admin/batch_upload_users') %}
                        <li class="breadcrumb-item"><a href="{{ url_for('admin.admin_memberships_dashboard') }}">Admin Dashboard</a></li>
                        <li class="breadcrumb-item active">Batch Add Users</li>
                    {% elif request.path.startswith('/admin/batch_upload') %}
                        <li class="breadcrumb-item"><a href="{{ url_for('admin.admin_memberships_dashboard') }}">Admin Dashboard</a></li>
                        <li class="breadcrumb-item active">Batch Upload Results</li>
                    {% elif request.path.startswith('/about') %}
                        <li class="breadcrumb-item"><a href="/overall">Overall</a></li>
                        <li class="breadcrumb-item active">About</li>
                    {% elif request.path.startswith('/contact') %}
                        <li class="breadcrumb-item"><a href="/overall">Overall</a></li>
                        <li class="breadcrumb-item active">Contact Us</li>
                    {% elif request.path.startswith('/login') %}
                        <li class="breadcrumb-item active">Log In</li>
                    {% elif request.path.startswith('/register') %}
                        <li class="breadcrumb-item active">Register</li>
                    {% endif %}
                </ol>
            </div>
        </nav>
        {% endblock %}

        <main class="container-fluid py-5 text-center">
            {% block main %}{% endblock %}
            
        </main>

        <footer class="mb-5 small text-center text-muted">

        </footer>
        <script>
            // Dark Mode Toggle
            function initDarkMode() {
                const darkModeToggle = document.querySelector('.dark-mode-toggle');
                const themeIcon = document.querySelector('.theme-icon');
                const htmlElement = document.documentElement;

                // Check localStorage for dark mode preference (default to dark mode)
                const isDarkMode = localStorage.getItem('darkMode') !== 'disabled';

                // Apply saved preference on page load
                if (isDarkMode) {
                    htmlElement.classList.add('dark-mode');
                    themeIcon.textContent = '‚òÄÔ∏è';
                }

                // Toggle dark mode on button click
                darkModeToggle.addEventListener('click', function() {
                    const isCurrentlyDark = htmlElement.classList.contains('dark-mode');

                    if (isCurrentlyDark) {
                        htmlElement.classList.remove('dark-mode');
                        localStorage.setItem('darkMode', 'disabled');
                        themeIcon.textContent = 'üåô';
                    } else {
                        htmlElement.classList.add('dark-mode');
                        localStorage.setItem('darkMode', 'enabled');
                        themeIcon.textContent = '‚òÄÔ∏è';
                    }
                });
            }

            // Initialize dark mode when DOM is ready
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initDarkMode);
            } else {
                initDarkMode();
            }
        </script>
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                var openPopupBtn = document.getElementById('open-popup-btn');
                var closePopupBtn = document.getElementById('close-popup-btn');
                var popup = document.getElementById('popup');
    
                openPopupBtn.addEventListener('click', function () {
                    popup.style.display = 'block';
                });
    
                closePopupBtn.addEventListener('click', function () {
                    popup.style.display = 'none';
                });
    
                window.addEventListener('click', function (event) {
                    if (event.target === popup) {
                        popup.style.display = 'none';
                    }
                });

                // Function to handle dragging of the popup box
                function dragPopup(event) {
                    event.preventDefault();
                    // Calculate the new position of the popup box
                    var offsetX = event.clientX - popup.offsetLeft;
                    var offsetY = event.clientY - popup.offsetTop;

                    // Function to move the popup box
                    function movePopup(event) {
                    event.preventDefault();
                    var x = event.clientX - offsetX;
                    var y = event.clientY - offsetY;
                    // Set the new position of the popup box
                    popup.style.left = x + 'px';
                    popup.style.top = y + 'px';
                    }

                    // Function to stop moving the popup box
                    function stopMovingPopup() {
                    document.removeEventListener('mousemove', movePopup);
                    document.removeEventListener('mouseup', stopMovingPopup);
                    }

                    document.addEventListener('mousemove', movePopup);
                    document.addEventListener('mouseup', stopMovingPopup);
                }

                // Add event listener to make the popup box draggable
                popup.addEventListener('mousedown', dragPopup);

            });
        </script>
    </body>
    
</html>
